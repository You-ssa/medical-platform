<!-- ===================================================== 
     DOSSIER MEDICAL TEMPLATE - dossier-medical.component.html
     ===================================================== -->

<div class="dossier-container">
  <div class="dossier-header">
    <h1>Mon Dossier M√©dical</h1>
    <p class="subtitle">G√©rez votre dossier de sant√© en toute s√©curit√©</p>
  </div>

  <!-- Success/Error Messages -->
  <div *ngIf="successMessage" class="alert alert-success fade-in">
    ‚úì {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-danger fade-in">
    ‚úó {{ errorMessage }}
  </div>

  <!-- TABS -->
  <div class="tabs-container">
    <button [class.active]="activeTab === 'infos'"
            (click)="setActiveTab('infos')"
            class="tab-button">
      üìã Informations M√©dicales
    </button>
    <button [class.active]="activeTab === 'contacts'"
            (click)="setActiveTab('contacts')"
            class="tab-button">
      üö® Contacts d'Urgence
    </button>
    <button [class.active]="activeTab === 'documents'"
            (click)="setActiveTab('documents')"
            class="tab-button">
      üìÑ Documents & Historique
    </button>
  </div>

  <!-- TAB: INFORMATIONS M√âDICALES -->
  <div *ngIf="activeTab === 'infos'" class="tab-content fade-in">
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          <span class="card-icon bg-primary">üíö</span>
          Dossier M√©dical
        </div>
        <button *ngIf="!isEditMode && dossierExists" 
                class="btn btn-primary btn-sm"
                (click)="toggleEditMode()">
          ‚úèÔ∏è Modifier
        </button>
      </div>

      <form [formGroup]="dossierForm" (ngSubmit)="onSubmitDossier()">
        <!-- Section 1: Informations Personnelles -->
        <div class="form-section">
          <h3 class="section-title">1Ô∏è‚É£ Informations Personnelles</h3>
          
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label required">Date de Naissance</label>
              <input type="date" 
                     class="form-control" 
                     formControlName="date_naissance">
            </div>

            <div class="form-group">
              <label class="form-label required">Groupe Sanguin</label>
              <select class="form-control form-select" formControlName="groupe_sanguin">
                <option value="">S√©lectionner</option>
                <option *ngFor="let groupe of groupesSanguins" [value]="groupe">
                  {{ groupe }}
                </option>
              </select>
            </div>
          </div>
        </div>

        <!-- Section 2: Informations M√©dicales -->
        <div class="form-section">
          <h3 class="section-title">2Ô∏è‚É£ Informations M√©dicales</h3>

          <!-- Maladies Chroniques -->
          <div class="form-group">
            <label class="form-label">Maladies Chroniques</label>
            <div class="checkbox-grid">
              <label *ngFor="let maladie of maladiesCommunesChroniques" class="checkbox-item">
                <input type="checkbox" 
                       [checked]="isItemSelected(dossierForm.get('maladies_chroniques')?.value, maladie)"
                       (change)="toggleArrayItem(dossierForm.get('maladies_chroniques')?.value, maladie)">
                <span>{{ maladie }}</span>
              </label>
            </div>
          </div>

          <!-- Maladies H√©r√©ditaires -->
          <div class="form-group">
            <label class="form-label">Maladies H√©r√©ditaires</label>
            <div class="checkbox-grid">
              <label *ngFor="let maladie of maladiesCommunesHereditaires" class="checkbox-item">
                <input type="checkbox"
                       [checked]="isItemSelected(dossierForm.get('maladies_hereditaires')?.value, maladie)"
                       (change)="toggleArrayItem(dossierForm.get('maladies_hereditaires')?.value, maladie)">
                <span>{{ maladie }}</span>
              </label>
            </div>
          </div>

          <!-- Allergies -->
          <div class="form-group">
            <label class="form-label">Allergies</label>
            <div class="checkbox-grid">
              <label *ngFor="let allergie of allergiesCommunes" class="checkbox-item">
                <input type="checkbox"
                       [checked]="isItemSelected(dossierForm.get('allergies')?.value, allergie)"
                       (change)="toggleArrayItem(dossierForm.get('allergies')?.value, allergie)">
                <span>{{ allergie }}</span>
              </label>
            </div>
          </div>

          <!-- M√©dicaments en Cours -->
          <div class="form-group">
            <label class="form-label">M√©dicaments en Cours</label>
            <textarea class="form-control" 
                      rows="3"
                      placeholder="Liste des m√©dicaments que vous prenez actuellement (un par ligne)"></textarea>
            <div class="form-hint">S√©parez chaque m√©dicament par une nouvelle ligne</div>
          </div>

          <!-- Observations M√©dicales -->
          <div class="form-group">
            <label class="form-label">Observations M√©dicales</label>
            <textarea class="form-control" 
                      formControlName="observations_medicales"
                      rows="4"
                      placeholder="Autres informations m√©dicales importantes"></textarea>
          </div>
        </div>

        <!-- Section 4: Consentements -->
        <div class="form-section">
          <h3 class="section-title">4Ô∏è‚É£ Consentements</h3>

          <div class="form-group">
            <label class="checkbox-item consent-item">
              <input type="checkbox" formControlName="don_organes">
              <span>
                <strong>Don d'organes</strong>
                <small>J'accepte le don d'organes en cas de d√©c√®s</small>
              </span>
            </label>
          </div>

          <div class="form-group">
            <label class="form-label">Directives Anticip√©es</label>
            <textarea class="form-control" 
                      formControlName="directives_anticipees"
                      rows="4"
                      placeholder="Indiquez vos souhaits concernant vos soins m√©dicaux"></textarea>
            <div class="form-hint">
              Pr√©cisez vos volont√©s en mati√®re de soins si vous ne pouvez plus les exprimer
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div *ngIf="isEditMode" class="form-actions">
          <button type="button" 
                  class="btn btn-secondary"
                  (click)="toggleEditMode()">
            ‚ùå Annuler
          </button>
          <button type="submit" 
                  class="btn btn-success"
                  [disabled]="dossierForm.invalid || loading">
            <span *ngIf="!loading">üíæ Enregistrer</span>
            <span *ngIf="loading">‚è≥ Enregistrement...</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- TAB: CONTACTS D'URGENCE -->
  <div *ngIf="activeTab === 'contacts'" class="tab-content fade-in">
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          <span class="card-icon bg-danger">üö®</span>
          Contacts d'Urgence
        </div>
        <button class="btn btn-primary btn-sm" (click)="addContact()">
          ‚ûï Ajouter un Contact
        </button>
      </div>

      <form [formGroup]="contactsForm" (ngSubmit)="onSubmitContacts()">
        <div formArrayName="contacts">
          <div *ngFor="let contact of contacts.controls; let i = index" 
               [formGroupName]="i"
               class="contact-item">
            <div class="contact-header">
              <h4>Contact {{ i + 1 }}</h4>
              <button type="button" 
                      class="btn btn-danger btn-sm"
                      (click)="removeContact(i)">
                üóëÔ∏è Supprimer
              </button>
            </div>

            <div class="form-grid">
              <div class="form-group">
                <label class="form-label required">Nom Complet</label>
                <input type="text" 
                       class="form-control" 
                       formControlName="nom"
                       placeholder="Nom du contact">
              </div>

              <div class="form-group">
                <label class="form-label required">Lien</label>
                <select class="form-control form-select" formControlName="lien">
                  <option value="">S√©lectionner</option>
                  <option value="P√®re">P√®re</option>
                  <option value="M√®re">M√®re</option>
                  <option value="Fr√®re">Fr√®re</option>
                  <option value="S≈ìur">S≈ìur</option>
                  <option value="Conjoint(e)">Conjoint(e)</option>
                  <option value="Ami(e)">Ami(e)</option>
                  <option value="Autre">Autre</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label required">T√©l√©phone</label>
                <input type="tel" 
                       class="form-control" 
                       formControlName="telephone"
                       placeholder="+216 XX XXX XXX">
              </div>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" 
                  class="btn btn-success"
                  [disabled]="contactsForm.invalid || loading">
            üíæ Enregistrer les Contacts
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- TAB: DOCUMENTS & HISTORIQUE -->
  <div *ngIf="activeTab === 'documents'" class="tab-content fade-in">
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          <span class="card-icon bg-warning">üìÑ</span>
          Documents M√©dicaux
        </div>
        <button class="btn btn-primary btn-sm">
          üì§ T√©l√©verser Document
        </button>
      </div>

      <div class="empty-state">
        <div class="empty-icon">üìÅ</div>
        <h3>Aucun document pour le moment</h3>
        <p>T√©l√©versez vos analyses, imageries et autres documents m√©dicaux</p>
        <button class="btn btn-primary">
          ‚ûï Ajouter le premier document
        </button>
      </div>
    </div>
  </div>
</div>
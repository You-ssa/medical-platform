<!-- src/app/register/register.component.html -->
<div class="auth-container">
  <div class="auth-card">

    <!-- Tabs -->
    <div class="user-type-tabs">
      <button class="tab-btn active" type="button"><i class="fas fa-user"></i> Patient</button>
      <button class="tab-btn" (click)="goToRegisterMedecin()" type="button"><i class="fas fa-user-md"></i> Médecin</button>
      <button class="tab-btn" (click)="goToRegisterSecretaire()" type="button"><i class="fas fa-user-tie"></i> Secrétaire</button>
    </div>

    <h2>Inscription Patient</h2>

    <!-- Loading -->
    <div *ngIf="dataLoading" class="loading-message">
      <i class="fas fa-spinner fa-spin"></i> Chargement des données...
    </div>

    <form (ngSubmit)="verifyCode()" *ngIf="!dataLoading">

      <!-- Étape 1 : Photo + Nom/Prénom + Sexe -->
      <div *ngIf="currentStep === 1" class="step">
        <div class="photo-circle" (click)="photoInput.click()">
          <img *ngIf="photoPreview" [src]="photoPreview" alt="Photo">
          <i *ngIf="!photoPreview" class="fas fa-camera"></i>
        </div>
        <input type="file" #photoInput accept="image/*" (change)="onPhotoSelected($event)" hidden>

        <div class="form-row">
          <div class="form-group">
            <label for="nom">Nom *</label>
            <input type="text" id="nom" [(ngModel)]="nom" name="nom" placeholder="Nom" required>
          </div>
          <div class="form-group">
            <label for="prenom">Prénom *</label>
            <input type="text" id="prenom" [(ngModel)]="prenom" name="prenom" placeholder="Prénom" required>
          </div>
        </div>

        <div class="form-group">
          <label for="sexe">Sexe *</label>
          <select id="sexe" [(ngModel)]="sexe" name="sexe" required>
            <option value="">Sélectionner</option>
            <option value="Homme">Homme</option>
            <option value="Femme">Femme</option>
            <option value="Autre">Autre</option>
          </select>
        </div>

        <div class="step-buttons">
          <button type="button" (click)="nextStep()">Suivant →</button>
        </div>
      </div>

      <!-- Étape 2 : Pays + Ville + Téléphone -->
      <div *ngIf="currentStep === 2" class="step">
        <div class="form-group">
          <label for="email">Email *</label>
          <input type="email" id="email" [(ngModel)]="email" name="email" placeholder="votre@email.com" required>
        </div>

        <div class="form-group">
          <label for="pays">Pays *</label>
          <select id="pays" [(ngModel)]="pays" name="pays" (change)="onPaysChange()" required>
            <option value="">Sélectionnez un pays</option>
            <option *ngFor="let p of paysList" [value]="p.nom">{{ p.drapeau }} {{ p.nom }}</option>
          </select>
        </div>

        <div class="form-group">
          <label for="ville">Ville *</label>
          <select id="ville" [(ngModel)]="ville" name="ville" [disabled]="!pays" required>
            <option value="">Sélectionnez une ville</option>
            <option *ngFor="let v of villesList" [value]="v">{{ v }}</option>
          </select>
        </div>

        <div class="form-group">
          <label for="telephone">Téléphone *</label>
          <div class="phone-input-group">
            <span class="phone-prefix">{{ phonePrefix || '+' }}</span>
            <input type="tel" id="telephone" [(ngModel)]="telephone" name="telephone" placeholder="XX XXX XXX" required>
          </div>
        </div>

        <div class="step-buttons">
          <button type="button" (click)="prevStep()">← Retour</button>
          <button type="button" (click)="nextStep()">Suivant →</button>
        </div>
      </div>

      <!-- Étape 3 : Mot de passe + Confirmation + Checkbox -->
      <div *ngIf="currentStep === 3" class="step">
        <div class="form-group">
          <label for="motDePasse">Mot de passe *</label>
          <input type="password" id="motDePasse" [(ngModel)]="motDePasse" name="motDePasse" placeholder="••••••••" required>
        </div>

        <div class="form-group">
          <label for="confMotDePasse">Confirmer mot de passe *</label>
          <input type="password" id="confMotDePasse" [(ngModel)]="confMotDePasse" name="confMotDePasse" placeholder="••••••••" required>
        </div>

        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" [(ngModel)]="acceptConditions" name="acceptConditions" required>
            J'accepte les conditions d'utilisation et la politique de confidentialité *
          </label>
        </div>

        <div class="step-buttons">
          <button type="button" (click)="prevStep()">← Retour</button>
          <button type="button" (click)="nextStep()">Suivant →</button>
        </div>
      </div>

      <!-- ✅ ÉTAPE 4 NOUVEAU : Vérification Email -->
      <div *ngIf="currentStep === 4" class="step verification-step">
        <div class="verification-icon">
          <i class="fas fa-envelope"></i>
        </div>

        <h3>Vérifiez votre email</h3>
        <p class="verification-info">
          Nous avons envoyé un code à 6 chiffres à<br>
          <strong>{{ email }}</strong>
        </p>

        <div class="form-group">
          <label for="verificationCode">Code de vérification *</label>
          <input 
            type="text" 
            id="verificationCode" 
            [(ngModel)]="verificationCode" 
            name="verificationCode" 
            placeholder="000000" 
            maxlength="6"
            class="code-input"
            [disabled]="codeVerified"
            required>
        </div>

        <div class="resend-section" *ngIf="!codeVerified">
          <p *ngIf="resendCooldown > 0" class="resend-cooldown">
            Renvoyer le code dans {{ resendCooldown }}s
          </p>
          <button 
            type="button" 
            class="btn-link" 
            (click)="resendCode()"
            [disabled]="resendCooldown > 0">
            <i class="fas fa-redo"></i> Renvoyer le code
          </button>
        </div>

        <div class="step-buttons">
          <button type="button" (click)="prevStep()" [disabled]="isLoading || codeVerified">← Retour</button>
          <button type="submit" [disabled]="isLoading || codeVerified || verificationCode.length !== 6">
            <span *ngIf="!isLoading && !codeVerified">Vérifier et créer mon compte</span>
            <span *ngIf="isLoading"><i class="fas fa-spinner fa-spin"></i> Vérification...</span>
            <span *ngIf="codeVerified"><i class="fas fa-check"></i> Vérifié !</span>
          </button>
        </div>
      </div>

      <!-- Points de progression -->
      <div class="step-indicator">
        <span *ngFor="let step of [].constructor(totalSteps); let i = index" [class.active]="i+1 === currentStep"></span>
      </div>

      <!-- Messages -->
      <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>
      <div class="success-message" *ngIf="successMessage">{{ successMessage }}</div>

    </form>

    <div class="auth-footer">
      Vous avez déjà un compte ? <a routerLink="/login">Se connecter</a>
    </div>
  </div>
</div>